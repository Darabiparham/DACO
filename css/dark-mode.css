/* Dark Mode Variables */
:root.dark {
    /* پایه رنگ‌ها */
    --background-light: #0F0F23;
    --background-dark: #FFFFFF;
    --surface-light: #1A1A3A;
    --surface-dark: #F8F9FA;
    --surface-elevated: #252547;
    
    /* متن */
    --text-primary: #E2E8F0;
    --text-secondary: #A0AEC0;
    --text-light: #FFFFFF;
    --text-muted: #718096;
    
    /* بوردر */
    --border-light: #2D3748;
    --border-medium: #4A5568;
    --border-dark: #CBD5E0;
    
    /* سایه‌ها */
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.4);
    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4);
    --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.4);
    --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.4);
    
    /* رنگ‌های وضعیت */
    --success-color: #68D391;
    --error-color: #FC8181;
    --warning-color: #F6AD55;
    --info-color: #63B3ED;
}

/* Dark Mode Base Styles */
.dark {
    color-scheme: dark;
}

.dark body {
    background-color: var(--background-light);
    color: var(--text-primary);
}

/* Dark Mode Components */

/* App Header */
.dark .app-header {
    background: linear-gradient(135deg, #1A1A3A, #0F0F23);
    border-bottom: 1px solid var(--border-medium);
}

/* Canvas */
.dark .canvas-container {
    background: var(--surface-light);
}

.dark .canvas-header {
    background: var(--surface-elevated);
    border: 1px solid var(--border-medium);
}

.dark .story-canvas {
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
}

.dark .canvas-overlay {
    background: rgba(15, 15, 35, 0.9);
}

.dark .drop-zone {
    border-color: rgba(93, 92, 222, 0.4);
    background: rgba(93, 92, 222, 0.05);
}

.dark .drop-zone.dragover {
    border-color: var(--primary-color);
    background: rgba(93, 92, 222, 0.2);
}

/* Text Overlay */
.dark .text-overlay {
    color: var(--text-light);
}

.dark .text-overlay.selected {
    border-color: var(--primary-color);
    background: rgba(93, 92, 222, 0.2);
}

/* Grid Lines */
.dark .grid-line {
    background: rgba(255, 255, 255, 0.3);
}

.dark .guideline {
    background: var(--primary-color);
}

/* Controls Panel */
.dark .controls-panel {
    background: var(--surface-elevated);
    border-color: var(--border-medium);
}

.dark .controls-header {
    background: var(--surface-light);
    border-color: var(--border-medium);
}

.dark .control-section {
    border-color: var(--border-medium);
}

/* Form Elements */
.dark .text-input {
    background: var(--surface-light);
    border-color: var(--border-medium);
    color: var(--text-primary);
}

.dark .text-input:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.2);
}

.dark .text-input::placeholder {
    color: var(--text-muted);
}

/* Buttons */
.dark .tool-btn,
.dark .zoom-btn,
.dark .quick-action,
.dark .nav-item,
.dark .font-btn,
.dark .style-btn,
.dark .align-btn,
.dark .animation-btn,
.dark .filter-btn,
.dark .slider-btn {
    background: var(--surface-elevated);
    border-color: var(--border-medium);
    color: var(--text-primary);
}

.dark .tool-btn:hover,
.dark .zoom-btn:hover,
.dark .quick-action:hover,
.dark .nav-item:hover,
.dark .font-btn:hover,
.dark .style-btn:hover,
.dark .align-btn:hover,
.dark .animation-btn:hover,
.dark .filter-btn:hover,
.dark .slider-btn:hover {
    background: var(--primary-color);
    color: var(--text-light);
    border-color: var(--primary-color);
}

.dark .font-btn.active,
.dark .style-btn.active,
.dark .align-btn.active,
.dark .animation-btn.active,
.dark .filter-btn.active {
    background: var(--primary-color);
    color: var(--text-light);
    border-color: var(--primary-color);
}

.dark .nav-item.active {
    background: rgba(93, 92, 222, 0.2);
    color: var(--primary-color);
}

.dark .input-action-btn {
    background: var(--surface-light);
    color: var(--text-secondary);
}

.dark .input-action-btn:hover {
    background: var(--primary-color);
    color: var(--text-light);
}

/* Upload Area */
.dark .upload-area {
    background: var(--surface-light);
    border-color: var(--border-medium);
}

.dark .upload-area:hover {
    border-color: var(--primary-color);
    background: rgba(93, 92, 222, 0.1);
}

.dark .upload-btn {
    background: var(--primary-color);
    color: var(--text-light);
}

.dark .upload-btn:hover {
    background: var(--primary-hover);
}

/* Sliders */
.dark .slider {
    background: var(--border-medium);
}

.dark .slider::-webkit-slider-thumb {
    background: var(--primary-color);
    box-shadow: 0 2px 6px rgba(93, 92, 222, 0.4);
}

.dark .slider::-moz-range-thumb {
    background: var(--primary-color);
    box-shadow: 0 2px 6px rgba(93, 92, 222, 0.4);
}

.dark .slider-value {
    background: var(--surface-light);
    color: var(--text-primary);
}

/* Color Controls */
.dark .color-picker {
    border-color: var(--border-medium);
}

.dark .color-picker:hover {
    border-color: var(--primary-color);
}

.dark .color-preset {
    border-color: var(--border-medium);
}

.dark .color-preset:hover {
    border-color: var(--primary-color);
}

.dark .gradient-btn {
    background: var(--surface-elevated);
    border-color: var(--border-medium);
    color: var(--text-primary);
}

.dark .gradient-btn:hover {
    background: rgba(93, 92, 222, 0.1);
    border-color: var(--primary-color);
    color: var(--primary-color);
}

.dark .gradient-btn.active {
    background: var(--primary-color);
    color: var(--text-light);
}

.dark .gradient-preset {
    border-color: var(--border-medium);
}

.dark .gradient-preset:hover {
    border-color: var(--primary-color);
}

/* Export Panel */
.dark .export-panel {
    background: var(--surface-elevated);
    border-color: var(--border-medium);
    box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.6);
}

.dark .export-option {
    background: var(--surface-light);
    border-color: var(--border-medium);
}

.dark .export-option:hover {
    background: rgba(93, 92, 222, 0.1);
    border-color: var(--primary-color);
}

.dark .export-option-icon {
    background: var(--primary-color);
    color: var(--text-light);
}

.dark .export-action.primary {
    background: var(--primary-color);
    color: var(--text-light);
}

.dark .export-action.primary:hover {
    background: var(--primary-hover);
}

.dark .export-action.secondary {
    background: var(--surface-light);
    color: var(--text-primary);
    border-color: var(--border-medium);
}

.dark .export-action.secondary:hover {
    background: var(--border-medium);
}

/* Sidebar */
.dark .sidebar {
    background: var(--surface-elevated);
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.6);
}

.dark .sidebar-header {
    border-color: var(--border-medium);
}

.dark .close-sidebar {
    color: var(--text-secondary);
}

.dark .close-sidebar:hover {
    background: var(--surface-light);
    color: var(--primary-color);
}

.dark .sidebar-nav a {
    color: var(--text-primary);
}

.dark .sidebar-nav a:hover {
    background: rgba(93, 92, 222, 0.2);
    color: var(--primary-color);
}

.dark .sidebar-footer {
    border-color: var(--border-medium);
}

.dark .social-links a {
    background: var(--surface-light);
    color: var(--text-primary);
}

.dark .social-links a:hover {
    background: var(--primary-color);
    color: var(--text-light);
}

/* Modals */
.dark .modal-content {
    background: var(--surface-elevated);
    color: var(--text-primary);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
}

.dark .modal-header {
    border-color: var(--border-medium);
}

.dark .modal-close {
    color: var(--text-secondary);
}

.dark .modal-close:hover {
    background: var(--surface-light);
    color: var(--error-color);
}

/* Image Picker Modal */
.dark .tab-btn {
    background: var(--surface-light);
    border-color: var(--border-medium);
    color: var(--text-primary);
}

.dark .tab-btn.active {
    background: var(--primary-color);
    color: var(--text-light);
}

.dark .tab-btn:hover {
    background: rgba(93, 92, 222, 0.1);
    color: var(--primary-color);
}

.dark .upload-dropzone {
    background: var(--surface-light);
    border-color: var(--border-medium);
}

.dark .dropzone-content {
    color: var(--text-primary);
}

.dark .search-input {
    background: var(--surface-light);
    border-color: var(--border-medium);
    color: var(--text-primary);
}

.dark .search-input::placeholder {
    color: var(--text-muted);
}

.dark .search-input:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.2);
}

.dark .search-btn {
    background: var(--primary-color);
    color: var(--text-light);
}

.dark .search-btn:hover {
    background: var(--primary-hover);
}

/* Settings Modal */
.dark .settings-section {
    border-color: var(--border-medium);
}

.dark .setting-label {
    color: var(--text-primary);
}

.dark .checkmark {
    background: var(--surface-light);
    border-color: var(--border-medium);
}

.dark .setting-label input:checked ~ .checkmark {
    background: var(--primary-color);
    border-color: var(--primary-color);
}

.dark select {
    background: var(--surface-light);
    border-color: var(--border-medium);
    color: var(--text-primary);
}

.dark .settings-btn.primary {
    background: var(--primary-color);
    color: var(--text-light);
}

.dark .settings-btn.secondary {
    background: var(--surface-light);
    border-color: var(--border-medium);
    color: var(--text-primary);
}

/* Context Menu */
.dark .context-menu {
    background: var(--surface-elevated);
    border-color: var(--border-medium);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.6);
}

.dark .context-item {
    color: var(--text-primary);
}

.dark .context-item:hover {
    background: var(--primary-color);
    color: var(--text-light);
}

.dark .context-separator {
    background: var(--border-medium);
}

/* Notifications */
.dark .notification {
    background: var(--surface-elevated);
    color: var(--text-primary);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
}

.dark .notification.success {
    background: var(--success-color);
    color: var(--text-light);
}

.dark .notification.error {
    background: var(--error-color);
    color: var(--text-light);
}

.dark .notification.warning {
    background: var(--warning-color);
    color: var(--text-light);
}

.dark .notification.info {
    background: var(--info-color);
    color: var(--text-light);
}

/* Offline Alert */
.dark .offline-alert {
    background: var(--surface-elevated);
    color: var(--text-primary);
}

/* Portrait Alert */
.dark .portrait-alert {
    background: linear-gradient(135deg, var(--surface-elevated), var(--surface-light));
    color: var(--text-light);
}

/* Update Banner */
.dark .update-banner {
    background: var(--surface-elevated);
    border-color: var(--border-medium);
    color: var(--text-primary);
}

.dark .update-btn {
    background: var(--primary-color);
    color: var(--text-light);
}

.dark .update-btn:hover {
    background: var(--primary-hover);
}

.dark .dismiss-btn {
    color: var(--text-secondary);
}

.dark .dismiss-btn:hover {
    color: var(--text-primary);
}

/* Install Prompt */
.dark .install-prompt {
    background: var(--surface-elevated);
    border-color: var(--border-medium);
    color: var(--text-primary);
}

.dark .install-btn.primary {
    background: var(--primary-color);
    color: var(--text-light);
}

.dark .install-btn.secondary {
    background: var(--surface-light);
    border-color: var(--border-medium);
    color: var(--text-primary);
}

/* Theme Toggle Button */
.dark .theme-toggle .theme-icon::before {
    content: '☀️';
}

.theme-toggle .theme-icon::before {
    content: '🌙';
}

/* Scrollbar Dark Mode */
.dark ::-webkit-scrollbar-track {
    background: var(--surface-light);
}

.dark ::-webkit-scrollbar-thumb {
    background: var(--border-medium);
}

.dark ::-webkit-scrollbar-thumb:hover {
    background: var(--primary-color);
}

/* Dark Mode Transitions */
.dark * {
    transition: background-color 0.3s ease, 
                border-color 0.3s ease, 
                color 0.3s ease, 
                box-shadow 0.3s ease;
}

/* Auto Dark Mode Based on Time */
@media (prefers-color-scheme: dark) {
    :root {
        --background-light: #0F0F23;
        --surface-light: #1A1A3A;
        --surface-elevated: #252547;
        --text-primary: #E2E8F0;
        --text-secondary: #A0AEC0;
        --border-light: #2D3748;
        --border-medium: #4A5568;
    }
}

/* High Contrast Dark Mode */
@media (prefers-contrast: high) {
    .dark {
        --border-light: #FFFFFF;
        --border-medium: #FFFFFF;
        --text-primary: #FFFFFF;
        --text-secondary: #E2E8F0;
    }
    
    .dark .text-overlay.selected {
        border-color: #FFFFFF;
        border-width: 3px;
    }
}

/* Dark Mode Image Adjustments */
.dark .story-image {
    filter: brightness(0.9) contrast(1.1);
}

.dark .story-image.high-contrast {
    filter: brightness(0.8) contrast(1.2) saturate(0.9);
}

/* Dark Mode Animation Adjustments */
.dark .animate-glow {
    animation: glowDark 2s ease-in-out infinite alternate;
}

@keyframes glowDark {
    0%, 100% { 
        text-shadow: 0 0 5px currentColor, 0 0 10px currentColor;
    }
    50% { 
        text-shadow: 0 0 15px currentColor, 0 0 25px currentColor, 0 0 35px currentColor;
    }
}

/* Dark Mode Focus States */
.dark .text-overlay:focus {
    outline-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.3);
}

.dark .focus-glow:focus {
    box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.4);
}

/* Dark Mode Loading Screen */
.dark .loading-screen {
    background: linear-gradient(135deg, #1A1A3A, #0F0F23);
}

/* Dark Mode Print Adjustments */
@media print {
    .dark body {
        background: white !important;
        color: black !important;
    }
    
    .dark .story-canvas {
        border-color: black !important;
    }
    
    .dark .text-overlay {
        color: black !important;
        -webkit-print-color-adjust: exact;
        color-adjust: exact;
    }
}

/* Dark Mode Performance Optimizations */
.dark .text-overlay,
.dark .story-canvas,
.dark .sidebar,
.dark .export-panel {
    will-change: auto;
}

/* Dark Mode Reduced Motion */
@media (prefers-reduced-motion: reduce) {
    .dark * {
        transition: none !important;
    }
}